/*!
 * Copyright (c) 2016 Tom Alexander
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
 * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE
 * OR OTHER DEALINGS IN THE SOFTWARE.
 */
!function(r){"use strict";var t=function(r,t){for(var n=0,a=0,o=0,e=0,h=r.length,u=0;u<h;u++)n+=r[u][1];e=n/h;for(var u=0;u<h;u++)o+=Math.pow(r[u][1]-e,2),a+=Math.pow(r[u][1]-t[u][1],2);return 1-a/o},n=function(r,t){var n=0,a=0,o=0,e=0,h=0,u=r.length-1,i=new Array(t);for(n=0;n<u;n++){for(e=n,a=n+1;a<u;a++)Math.abs(r[n][a])>Math.abs(r[n][e])&&(e=a);for(o=n;o<u+1;o++)h=r[o][n],r[o][n]=r[o][e],r[o][e]=h;for(a=n+1;a<u;a++)for(o=u;o>=n;o--)r[o][a]-=r[o][n]*r[n][a]/r[n][n]}for(a=u-1;a>=0;a--){for(h=0,o=a+1;o<u;o++)h+=r[o][a]*i[o];i[a]=(r[u][a]-h)/r[a][a]}return i},a={linear:function(r){for(var n=[0,0,0,0,0],a=0,o=[];a<r.length;a++)null!==r[a][1]&&(n[0]+=r[a][0],n[1]+=r[a][1],n[2]+=r[a][0]*r[a][0],n[3]+=r[a][0]*r[a][1],n[4]+=r[a][1]*r[a][1]);for(var e=(a*n[3]-n[0]*n[1])/(a*n[2]-n[0]*n[0]),h=n[1]/a-e*n[0]/a,u=(a*n[3]-n[0]*n[1])/Math.sqrt((a*n[2]-n[0]*n[0])*(a*n[4]-n[1]*n[1])),i=Math.pow(u,2),l=0,p=r.length;l<p;l++){var f=[r[l][0],r[l][0]*e+h];o.push(f)}var s=h<0?"-":"+",M="y = "+Math.round(1e4*e)/1e4+"x "+s+" "+Math.abs(Math.round(1e4*h)/1e4);return{r2:t(r,o),equation:[e,h],points:o,string:M,correlation:u,rSquare:i}},linearThroughOrigin:function(r){for(var t=[0,0],n=0,a=[];n<r.length;n++)null!==r[n][1]&&(t[0]+=r[n][0]*r[n][0],t[1]+=r[n][0]*r[n][1]);for(var o=t[1]/t[0],e=0,h=r.length;e<h;e++){var u=[r[e][0],r[e][0]*o];a.push(u)}var i="y = "+Math.round(1e4*o)/1e4+"x";return{equation:[o],points:a,string:i}},exponential:function(r){var n=[0,0,0,0,0,0],a=0,o=[];for(l=r.length;a<l;a++)null!==r[a][1]&&(n[0]+=r[a][0],n[1]+=r[a][1],n[2]+=r[a][0]*r[a][0]*r[a][1],n[3]+=r[a][1]*Math.log(r[a][1]),n[4]+=r[a][0]*r[a][1]*Math.log(r[a][1]),n[5]+=r[a][0]*r[a][1]);for(var e=n[1]*n[2]-n[5]*n[5],h=Math.pow(Math.E,(n[2]*n[3]-n[5]*n[4])/e),u=(n[1]*n[4]-n[5]*n[3])/e,i=0,l=r.length;i<l;i++){var p=[r[i][0],h*Math.pow(Math.E,u*r[i][0])];o.push(p)}var f="y = "+Math.round(1e4*h)/1e4+"e^("+Math.round(1e4*u)/1e4+"x)";return{r2:t(r,o),equation:[h,u],points:o,string:f}},logarithmic:function(r){var n=[0,0,0,0,0],a=0,o=[];for(p=r.length;a<p;a++)null!==r[a][1]&&(n[0]+=Math.log(r[a][0]),n[1]+=r[a][1]*Math.log(r[a][0]),n[2]+=r[a][1],n[3]+=Math.pow(Math.log(r[a][0]),2),n[4]+=Math.pow(r[a][1],2));for(var e=(a*n[1]-n[2]*n[0])/(a*n[3]-n[0]*n[0]),h=(n[2]-e*n[0])/a,u=(a*n[1]-n[2]*n[0])/Math.sqrt((a*n[3]-n[0]*n[0])*(a*n[4]-n[2]*n[2])),i=Math.pow(u,2),l=0,p=r.length;l<p;l++){var f=[r[l][0],h+e*Math.log(r[l][0])];o.push(f)}var s=h<0?"-":"+",M="y = "+Math.round(1e4*e)/1e4+" ln(x) "+s+" "+Math.abs(Math.round(1e4*h)/1e4);return{r2:t(r,o),equation:[h,e],points:o,string:M,rSquare:i}},power:function(r){var n=[0,0,0,0],a=0,o=[];for(i=r.length;a<i;a++)null!==r[a][1]&&(n[0]+=Math.log(r[a][0]),n[1]+=Math.log(r[a][1])*Math.log(r[a][0]),n[2]+=Math.log(r[a][1]),n[3]+=Math.pow(Math.log(r[a][0]),2));for(var e=(a*n[1]-n[2]*n[0])/(a*n[3]-n[0]*n[0]),h=Math.pow(Math.E,(n[2]-e*n[0])/a),u=0,i=r.length;u<i;u++){var l=[r[u][0],h*Math.pow(r[u][0],e)];o.push(l)}var p="y = "+Math.round(1e4*h)/1e4+"x^"+Math.round(1e4*e)/1e4;return{r2:t(r,o),equation:[h,e],points:o,string:p}},polynomial:function(r,a){"undefined"==typeof a&&(a=2);for(var o=[],e=[],h=[],u=0,i=0,l=0,p=a+1;l<p;l++){for(var f=0,s=r.length;f<s;f++)null!==r[f][1]&&(u+=Math.pow(r[f][0],l)*r[f][1]);o.push(u),u=0;for(var M=[],g=0;g<p;g++){for(var f=0,s=r.length;f<s;f++)null!==r[f][1]&&(i+=Math.pow(r[f][0],l+g));M.push(i),i=0}e.push(M)}e.push(o);for(var v=n(e,p),l=0,s=r.length;l<s;l++){for(var c=0,d=0;d<v.length;d++)c+=v[d]*Math.pow(r[l][0],d);h.push([r[l][0],c])}for(var y="y = ",l=v.length-1;l>=0;l--)y+=l>1?Math.round(v[l]*Math.pow(10,l))/Math.pow(10,l)+"x^"+l+" + ":1==l?Math.round(1e4*v[l])/1e4+"x + ":Math.round(1e4*v[l])/1e4;return{r2:t(r,h),equation:v,points:h,string:y}},movingAverage:function(r,t){var n=[],a=[];for(var o in r){a.push(r[o]),a.length>t&&a.splice(0,1);var e=0;for(var o in a)e+=a[o];var h=t;a.length<t&&(h=a.length),n.push(e/h)}return n.splice(0,t-1),n},sigmoid:function(r,t){function n(r,t,n,a,o){for(var e=[],h=0;h<r.length;h++){var u=Math.exp((r[h]-o)/a),i=(t+n*u)/(1+u);e.push(i)}return e}function a(r,t,n){if("undefined"==typeof n&&(n=Math.max(Math.round(t-r)+1,1)),n<2)return 1===n?[r]:[];var a,o=Array(n);for(n--,a=n;a>=0;a--)o[a]=(a*t+(n-a)*r)/n;return o}for(var o=r.map(function(r){return r[0]}),e=r.map(function(r){return r[1]}),h=99999999,u=0,i=0,l=[],p=Math.min.apply(null,e),f=Math.max.apply(null,e),s=Math.min.apply(null,o),M=Math.max.apply(null,o),g=-1e3;g<=1e3;g+=10)if(0!=g)for(var v=s;v<M;v+=10){var c=n(o,p,f,g,v),d=0;r.forEach(function(r,t,n){d+=Math.pow(c[t]-e[t],2)}),d<h&&(h=d,u=v,i=g)}for(var y=n(o,p,f,i,u),w=0,x=r.length;w<x;w++){var q=[r[w][0],y[w]];l.push(q)}var m="y = ("+p+" + "+f+"*e^((x-"+u+")/"+i+"))/(1+e^((x-"+u+")/"+i+"))";if("object"==typeof t){var b=t.offset,E=a(s-b,M+b,(M-s+2*b)/t.grain),A=n(E,p,f,i,u);return{equation:[p,f,i,u],points:l,string:m,span:{xspan:E,yspan:A}}}return{equation:[p,f,i,u],points:l,string:m}},lastvalue:function(r){for(var n=[],a=null,o=0;o<r.length;o++)r[o][1]?(a=r[o][1],n.push([r[o][0],r[o][1]])):n.push([r[o][0],a]);return{r2:t(r,n),equation:[a],points:n,string:""+a}}},o=function(r,t,n){if("string"==typeof r)return a[r](t,n)};"undefined"!=typeof exports?module.exports=o:r.regression=o}(this);